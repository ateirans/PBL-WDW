<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - FEASTFOUND</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        :root {
            --bg-cream: #f5e6cc;
            --text-dark: #4b3832;
            --accent-brown: #7c5747;
            --accent-orange: #f0a359;
            --accent-orange-dark: #e55c0a;
            --nav-bg-dark: rgba(40, 23, 3, 0.85);
        }

        body {
            background-color: var(--bg-cream); 
            background-image: url('bg3.png'); 
            background-size: cover;       
            background-position: center;  
            background-attachment: fixed; 
            background-repeat: no-repeat;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-dark);
            padding-top: 100px; 
        }

        .header-container {
            background-color: var(--nav-bg-dark);
            padding: 10px 20px; 
            border-radius: 50px;
            margin: 20px 20px 0 20px;
             box-shadow: 0 4px 8px rgb(147, 5, 5);
            backdrop-filter: blur(5px);
        }

        .nav-logo img {
            height: 50px;
            width: auto;
            border-radius: 50%;
            border: 2px solid var(--accent-orange);
            transition: transform 0.3s;
        }
        .nav-logo img:hover {
            transform: scale(1.1);
        }

        .nav-btn-admin {
            background-color: var(--accent-orange);
            color: white;
            font-weight: bold;
            font-size: 0.85rem;
            padding: 8px 15px;
            border-radius: 50px;
            text-decoration: none;
            transition: all 0.3s ease;
            margin: 0 3px;
            text-transform: uppercase;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .nav-btn-admin:hover {
            background-color: var(--accent-orange-dark);
            color: white;
            transform: translateY(-2px);
        }

        .nav-btn-admin.active {
            background-color: white;
            color: var(--accent-orange-dark);
            border: 2px solid var(--accent-orange);
        }

        .btn-logout {
            background-color: var(--accent-orange);
            color: white;
            border-radius: 50px;
            padding: 8px 20px;
            font-weight: bold;
            border: none;
            font-size: 0.9rem;
            transition: 0.3s;
            text-transform: uppercase;
        }
        .btn-logout:hover {
            background-color: #c82333;
            transform: translateY(-2px);
        }

        .content-card {
            background: rgba(255, 255, 255, 0.95); 
            border-radius: 15px;
            border: 2px solid var(--accent-brown);
            box-shadow: 0 5px 20px rgba(75, 56, 50, 0.1);
            margin-bottom: 30px;
            overflow: hidden;
        }
        
        .dashboard-stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-left: 6px solid var(--accent-orange);
            border-right: 1px solid #eee;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
            transition: transform 0.3s;
        }
        .dashboard-stat-card:hover {
            transform: translateY(-5px);
        }

        .custom-table thead {
            background-color: var(--accent-brown);
            color: white;
        }
        .custom-table th, .custom-table td {
            padding: 15px;
            vertical-align: middle;
        }
        .custom-table tbody tr:hover {
            background-color: #fff8f0;
        }

        /* Form */
        .admin-form-label {
            font-weight: 600;
            color: var(--accent-brown);
            margin-bottom: 8px;
        }
        .admin-input {
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 10px 15px;
            transition: 0.3s;
        }
        .admin-input:focus {
            border-color: var(--accent-orange);
            box-shadow: 0 0 8px rgba(240, 163, 89, 0.2);
            outline: none;
        }

        .admin-section { display: none; animation: fadeIn 0.5s; }
        .admin-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        @media (max-width: 992px) {
            .header-container { margin: 10px; padding: 10px; border-radius: 20px; }
            .navbar-nav { align-items: center; gap: 10px; margin-top: 10px; }
        }
    </style>
</head>
<body>

    <header class="header-container fixed-top">
        <nav class="navbar navbar-expand-lg p-0">
            <div class="container-fluid">
                <button class="navbar-toggler bg-light" type="button" data-bs-toggle="collapse" data-bs-target="#adminNavbar">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse justify-content-between align-items-center" id="adminNavbar">
                    <div class="d-flex flex-wrap justify-content-center justify-content-lg-start gap-1">
                        <a href="#" class="nav-btn-admin active" onclick="showSection('dashboard', this)">DASHBOARD</a>
                        <a href="#" class="nav-btn-admin" onclick="showSection('komisi', this)">KOMISI</a>
                        <a href="#" class="nav-btn-admin" onclick="showSection('produk', this)">PRODUK</a>
                        <a href="#" class="nav-btn-admin" onclick="showSection('vendor', this)">VENDOR</a>
                    </div>

                    <div class="nav-logo mx-3 text-center my-2 my-lg-0">
                        <a href="#"><img src="logopbl.png" alt="FEASTFOUND Admin" class="logo-img"></a>
                    </div>

                    <div class="d-flex justify-content-center justify-content-lg-end align-items-center">
                        <span class="me-3 fw-bold text-white d-none d-lg-block">Halo, Admin!</span>
                        <button onclick="logout()" class="btn-logout">
                            <i class="fas fa-sign-out-alt me-1"></i> LOGOUT
                        </button>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mt-5 pt-4">
        
        <section id="dashboard" class="admin-section active">
            <div class="row mb-4">
                <div class="col-12 text-center">
                    <h2 class="fw-bold" style="color: var(--accent-brown); text-shadow: 2px 2px 4px rgba(255,255,255,0.8);">Ringkasan & Laporan</h2>
                    <p style="color: #4b3832; font-weight: 500;">Pantau kinerja platform FeastFound secara realtime.</p>
                </div>
            </div>

            <div class="row g-4 mb-5">
                <div class="col-md-4">
                    <div class="dashboard-stat-card">
                        <h3>Total Penjualan</h3>
                        <p id="grossSales">Rp 0</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="dashboard-stat-card" style="border-left-color: #28a745;">
                        <h3>Pendapatan Komisi</h3>
                        <p id="platformCommissionRevenue">Rp 0</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="dashboard-stat-card" style="border-left-color: #17a2b8;">
                        <h3>Total Produk Aktif</h3>
                        <p id="totalProducts">0</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="komisi" class="admin-section">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="content-card p-5 text-center">
                        <h2 class="fw-bold mb-4" style="color: var(--accent-brown);">Pengaturan Komisi</h2>
                        <div class="bg-light p-4 rounded-3 mb-4 border">
                            <h5 class="text-muted">Rate Komisi Saat Ini</h5>
                            <h1 class="display-4 fw-bold" style="color: var(--accent-orange-dark);" id="currentCommissionRate">10%</h1>
                        </div>
                        <div class="input-group mb-3">
                            <input type="number" class="form-control admin-input" id="commissionRateInput" min="0" max="100" placeholder="Masukkan % baru">
                            <button class="btn" style="background: var(--accent-brown); color: white;" onclick="updateCommissionRate()">Simpan</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="produk" class="admin-section">
            <div class="row">
                <div class="col-md-4">
                    <div class="content-card p-4">
                        <h4 class="fw-bold mb-4" style="color: var(--accent-brown);">Tambah Produk</h4>
                        <form id="addProductForm">
                            <div class="mb-3">
                                <label class="admin-form-label">Nama Produk</label>
                                <input type="text" class="form-control admin-input" id="prodName" required>
                            </div>
                            <div class="mb-3">
                                <label class="admin-form-label">Harga (Rp)</label>
                                <input type="number" class="form-control admin-input" id="prodPrice" min="1000" required>
                            </div>
                            <div class="mb-3">
                                <label class="admin-form-label">Vendor</label>
                                <select class="form-select admin-input" id="prodVendor" required></select>
                            </div>
                            <button type="submit" class="btn w-100 fw-bold" style="background: var(--accent-brown); color: white;">Simpan</button>
                        </form>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="content-card p-4">
                        <h4 class="fw-bold mb-3" style="color: var(--accent-brown);">Daftar Produk</h4>
                        <div class="table-responsive">
                            <table class="table custom-table" id="adminProductTable">
                                <thead><tr><th>ID</th><th>Produk</th><th>Harga</th><th>Vendor</th><th>Aksi</th></tr></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="vendor" class="admin-section">
            <div class="row">
                <div class="col-md-4">
                    <div class="content-card p-4">
                        <h4 class="fw-bold mb-4" style="color: var(--accent-brown);">Tambah Vendor</h4>
                        <form id="addVendorForm">
                            <div class="mb-3">
                                <label class="admin-form-label">Nama Vendor</label>
                                <input type="text" class="form-control admin-input" id="vendorNameInput" required>
                            </div>
                            <button type="submit" class="btn w-100 fw-bold" style="background: var(--accent-brown); color: white;">Daftarkan</button>
                        </form>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="content-card p-4">
                        <h4 class="fw-bold mb-3" style="color: var(--accent-brown);">Mitra Vendor</h4>
                        <div class="table-responsive">
                            <table class="table custom-table" id="adminVendorTable">
                                <thead><tr><th>ID</th><th>Nama Vendor</th><th>Aksi</th></tr></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const initialVendors = [{ id: 1, name: 'Dapur Cepat Saji' }, { id: 2, name: 'Kopi Nusantara' }, { id: 3, name: 'Taco Loco' }];
    const initialProducts = [{ id: 101, name: 'Classic Beef Burger', price: 35000, vendorId: 1 }, { id: 102, name: 'Cheesy Hotdog', price: 28000, vendorId: 1 }, { id: 201, name: 'Boba Brown Sugar', price: 25000, vendorId: 2 }, { id: 301, name: 'Chicken Taco', price: 38000, vendorId: 3 }];
    const formatRupiah = (n) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(n);
    function saveProducts() { localStorage.setItem('feastfoundProducts', JSON.stringify(products)); }
    function saveVendors() { localStorage.setItem('adminVendors', JSON.stringify(vendors)); }
    function getVendorName(id) { return vendors.find(v => v.id === id)?.name || 'N/A'; }
    let products = JSON.parse(localStorage.getItem('feastfoundProducts'));
    let vendors = JSON.parse(localStorage.getItem('adminVendors'));
    if (!products || products.length === 0) {
        products = initialProducts;
        saveProducts(); 
    }

    if (!vendors || vendors.length === 0) {
        vendors = initialVendors;
        saveVendors(); 
    }
    
    let commissionRate = parseFloat(localStorage.getItem('commissionRate')) || 10;
    let totalGrossSales = parseFloat(localStorage.getItem('totalGrossSales')) || 0;

    function showSection(id, el) {
        document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(el) { document.querySelectorAll('.nav-btn-admin').forEach(b => b.classList.remove('active')); el.classList.add('active'); }
    }

    function addVendor(e) {
        e.preventDefault(); const name = document.getElementById('vendorNameInput').value.trim();
        if (!name) return alert('Nama kosong');
        vendors.push({ id: Date.now(), name }); saveVendors();
        document.getElementById('addVendorForm').reset(); renderAdminData();
    }

    function deleteVendor(id) {
        if (products.some(p => p.vendorId === id)) return alert('Hapus produk vendor ini dulu sebelum menghapus vendor!');
        if (confirm('Apakah Anda yakin ingin menghapus vendor ini?')) { vendors = vendors.filter(v => v.id !== id); saveVendors(); renderAdminData(); }
    }

    function updateCommissionRate() {
        const r = parseFloat(document.getElementById('commissionRateInput').value);
        if (r >= 0 && r <= 100) { 
            commissionRate = r; 
            localStorage.setItem('commissionRate', r); 
            renderAdminData(); 
            alert(`Rate Komisi berhasil diubah menjadi ${r}%!`);
        } else {
            alert('Komisi harus antara 0 hingga 100.');
        }
    }

    function addProduct(e) {
        e.preventDefault();
        const n = document.getElementById('prodName').value, 
              p = parseInt(document.getElementById('prodPrice').value), 
              v = parseInt(document.getElementById('prodVendor').value);
        
        if (p < 1000) return alert('Harga harus lebih dari Rp 1.000');
        
        products.push({ id: Date.now(), name: n, price: p, vendorId: v }); 
        saveProducts();
        document.getElementById('addProductForm').reset(); 
        renderAdminData();
        alert(`Produk "${n}" berhasil ditambahkan.`);
    }

    function deleteProduct(id) {
        if (confirm('Apakah Anda yakin ingin menghapus produk ini?')) { 
            products = products.filter(p => p.id !== id); 
            saveProducts(); 
            renderAdminData(); 
        }
    }

    function editProduct(id) {
        const p = products.find(x => x.id === id); 
        if(!p) return;
        
        let newName = prompt('Ubah Nama Produk:', p.name);
        if (newName === null) return; // Batal
        newName = newName.trim();
        if (newName === "") { alert("Nama produk tidak boleh kosong."); return; }

        let newPrice = prompt('Ubah Harga (Rp):', p.price);
        if (newPrice === null) return; // Batal
        newPrice = parseInt(newPrice.trim());

        if (isNaN(newPrice) || newPrice < 1000) { 
            alert("Harga tidak valid. Masukkan angka minimal Rp 1.000."); 
            return; 
        }

        p.name = newName; 
        p.price = newPrice; 
        saveProducts(); 
        renderAdminData();
        alert("Produk berhasil diperbarui!");
    }

    function renderAdminData() {
        // Dashboard 
        document.getElementById('totalProducts').textContent = products.length;
        document.getElementById('grossSales').textContent = formatRupiah(totalGrossSales);
        document.getElementById('platformCommissionRevenue').textContent = formatRupiah(totalGrossSales * (commissionRate / 100));
        
        // Komisi
        document.getElementById('currentCommissionRate').textContent = commissionRate + '%';

        // Produk Table
        const ptb = document.querySelector('#adminProductTable tbody');
        ptb.innerHTML = products.map(p => `<tr>
            <td>${p.id}</td>
            <td>${p.name}</td>
            <td>${formatRupiah(p.price)}</td>
            <td>${getVendorName(p.vendorId)}</td>
            <td>
                <button class="btn btn-sm btn-warning me-1" onclick="editProduct(${p.id})"><i class="fas fa-edit"></i></button>
                <button class="btn btn-sm btn-danger" onclick="deleteProduct(${p.id})"><i class="fas fa-trash"></i></button>
            </td>
        </tr>`).join('');

        // Vendor Table
        const vtb = document.querySelector('#adminVendorTable tbody');
        vtb.innerHTML = vendors.map(v => `<tr>
            <td>${v.id}</td>
            <td>${v.name}</td>
            <td><button class="btn btn-sm btn-danger" onclick="deleteVendor(${v.id})"><i class="fas fa-trash"></i></button></td>
        </tr>`).join('');

        // Produk++
        const vs = document.getElementById('prodVendor');
        vs.innerHTML = vendors.map(v => `<option value="${v.id}">${v.name}</option>`).join('');
    }

    function logout() { 
        if(confirm('Apakah Anda yakin ingin keluar?')) {
            localStorage.removeItem('role'); 
            localStorage.removeItem('userEmail'); 
            window.location.href = 'index.html'; 
        }
    }
    
    function adminInit() {
        if (localStorage.getItem('role') !== 'Admin') return window.location.href = 'index.html';
        renderAdminData();
        document.getElementById('addProductForm').addEventListener('submit', addProduct);
        document.getElementById('addVendorForm').addEventListener('submit', addVendor);
    }
    
    document.addEventListener('DOMContentLoaded', adminInit);
</script>